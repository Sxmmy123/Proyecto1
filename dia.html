<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Asistencia del D√≠a</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    .curso-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #f8f9fa;
    }

    .asistencia-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 12px;
      margin: 3px 0;
      border-radius: 5px;
      cursor: pointer;
      border: 1px solid black;
      transition: background-color 0.4s ease;
    }

    .estado-blanco { background-color: white; }
    .estado-verde { background-color: #d4edda; }
    .estado-amarillo { background-color: #fff3cd; }
    .estado-morado { background-color: #e0c3fc; }

    .leyenda {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .leyenda-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border: 1px solid black;
      border-radius: 5px;
    }

    .cuadro-color {
      width: 20px;
      height: 20px;
      border: 1px solid black;
    }

    .color-blanco { background-color: white; }
    .color-verde { background-color: #d4edda; }
    .color-amarillo { background-color: #fff3cd; }
    .color-morado { background-color: #e0c3fc; }

    /* Animaciones de deslizamiento */
    .slide-container {
      transition: transform 0.4s ease, opacity 0.4s ease;
    }
    .slide-left {
      transform: translateX(-100%);
      opacity: 0;
    }
    .slide-right {
      transform: translateX(100%);
      opacity: 0;
    }
  </style>
</head>
<body>
<div class="container py-4 slide-container" id="slideContainer">

  <!-- FILA 1: Navegaci√≥n general -->
  <div class="d-flex justify-content-between mb-3">
    <button class="btn btn-outline-primary" onclick="volverAlInicio()">üè† Inicio</button>
    <button class="btn btn-outline-secondary" onclick="volverAlMes()">üìÖ Tareas</button>
  </div>

  <!-- FILA 2: Navegaci√≥n entre d√≠as -->
  <div class="d-flex justify-content-between mb-3">
    <button class="btn btn-outline-dark" onclick="animarCambio(-1)">‚¨Ö D√≠a anterior</button>
    <button class="btn btn-outline-dark" onclick="animarCambio(1)">D√≠a siguiente ‚û°</button>
  </div>

  <h2 id="tituloDia" class="mb-1 text-center"></h2>
   <h6 class="mb-1 text-center">Codigo de colores</h6>
  <!-- Leyenda de colores -->
  <div class="leyenda">
    <div class="leyenda-item color-blanco">Falta</div>
    <div class="leyenda-item color-verde">Asistencia</div>
    <div class="leyenda-item color-amarillo">Atraso</div>
    <div class="leyenda-item color-morado">Permiso</div>
  </div>

  <!-- Aqu√≠ se cargan los cursos y alumnos -->
  <div id="detalleCursos"></div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  let anio = parseInt(params.get("anio"));
  let mes = parseInt(params.get("mes"));
  let dia = parseInt(params.get("dia"));

  const nombreMeses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio",
                       "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
  const diasSemana = ["Domingo","Lunes","Martes","Mi√©rcoles","Jueves","Viernes","Sabado"];

  const hoy = new Date();
  const esHoy = hoy.getFullYear() === anio &&
                hoy.getMonth() + 1 === mes &&
                hoy.getDate() === dia;

  function claveDeFecha() {
    return `${anio}-${mes.toString().padStart(2, "0")}-${dia.toString().padStart(2, "0")}`;
  }

  function volverAlMes() {
    window.location.href = `mes.html?anio=${anio}&mes=${mes}`;
  }

  function volverAlInicio() {
    window.location.href = `index.html`;
  }

  function cambiarDia(delta) {
    let nuevaFecha = new Date(anio, mes - 1, dia + delta);
    while (nuevaFecha.getDay() === 0 || nuevaFecha.getDay() === 6) {
      nuevaFecha.setDate(nuevaFecha.getDate() + (delta > 0 ? 1 : -1));
    }
    anio = nuevaFecha.getFullYear();
    mes = nuevaFecha.getMonth() + 1;
    dia = nuevaFecha.getDate();
    window.location.href = `dia.html?anio=${anio}&mes=${mes}&dia=${dia}`;
  }

  function animarCambio(delta) {
    const cont = document.getElementById("slideContainer");
    cont.classList.add(delta > 0 ? "slide-left" : "slide-right");
    setTimeout(() => cambiarDia(delta), 400);
  }

  function mostrarInformacion(modoEdicion = false) {
    const fecha = new Date(anio, mes - 1, dia);
    document.getElementById("tituloDia").innerText =
      `${diasSemana[fecha.getDay()]}, ${dia} de ${nombreMeses[mes - 1]} de ${anio}`;

    const detalleContainer = document.getElementById("detalleCursos");
    detalleContainer.innerHTML = "";

    const alumnosPorCurso = JSON.parse(localStorage.getItem("alumnos")) || {};
    const asistencias = JSON.parse(localStorage.getItem("asistencias")) || {};
    const cursos = Object.keys(alumnosPorCurso);

    if (cursos.length === 0) {
      detalleContainer.innerHTML = `<p class="text-muted text-center">No hay cursos asignados.</p>`;
      return;
    }

    cursos.forEach(curso => {
      const div = document.createElement("div");
      div.className = "curso-card";
      div.innerHTML = `<h5>${curso}</h5>`;

      const listaAlumnos = alumnosPorCurso[curso] || [];

      if (listaAlumnos.length === 0) {
        div.innerHTML += `<p class="text-muted">No hay alumnos registrados en este curso.</p>`;
      } else {
        listaAlumnos.forEach(nombre => {
          const claveAlumno = `${claveDeFecha()}|${curso}|${nombre}`;
          const estado = asistencias[claveAlumno] || "blanco";

          const estadoColor = {
            blanco: "estado-blanco",
            verde: "estado-verde",
            amarillo: "estado-amarillo",
            morado: "estado-morado"
          }[estado];

          const divAlumno = document.createElement("div");
          divAlumno.className = `asistencia-item ${estadoColor}`;
          divAlumno.textContent = nombre;

          if (esHoy || modoEdicion) {
            divAlumno.onclick = () => {
              const nuevoEstado = obtenerSiguienteEstado(estado);
              asistencias[claveAlumno] = nuevoEstado;
              localStorage.setItem("asistencias", JSON.stringify(asistencias));
              mostrarInformacion(modoEdicion);
            };
          }

          div.appendChild(divAlumno);
        });
      }

      detalleContainer.appendChild(div);
    });

    if (!esHoy && !modoEdicion) {
      const btnEditar = document.createElement("button");
      btnEditar.className = "btn btn-sm btn-warning mt-3";
      btnEditar.textContent = "‚úèÔ∏è Editar asistencia";
      btnEditar.onclick = () => mostrarInformacion(true);
      detalleContainer.appendChild(btnEditar);
    }
  }

  function obtenerSiguienteEstado(estadoActual) {
    switch (estadoActual) {
      case "blanco": return "verde";
      case "verde": return "amarillo";
      case "amarillo": return "morado";
      case "morado": return "blanco";
      default: return "blanco";
    }
  }

  mostrarInformacion();
</script>
</body>
</html>
